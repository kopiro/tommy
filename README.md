# Tommy: Web Assets converter and optimizer

Tommy will process and optimize all your static assets ready for the web no matter what is the file extensions;
and, to avoid time wasting, it will save processed items so that unmodified assets will not be processed further.

You can optionally configure Tommy to sync all your processed assets to a S3 bucket.

File treatment:

- **Image files** will be:
  _ resized in multiple images and optimized
  _ optimized with various specific tools
- **Video files** will be:
  _ converted to `mp4, webm`
  _ a poster image will be extracted
- **All other static assets** will be just copied and kept untouched

## Pass runtime options

- `--src` will specify the source directory (where your assets are located)
- `--dst` will specify the destination directory (where your assets will be generated)

## Configuration

If you pass to Tommy an additional JSON file, it will be merged with initial config.

```sh
tommy --config config.json
```

Example:

```json
{
  "version": "v1",
  "resize": [200, 400, 800],
  "ignore": [".DS_Store", ".gitignore"]
}
```

### `version`

Specify a version of the configuration.
If this value changes, all assets will be regenerated.

### `resize`

Array of dimensions in PX that specify the images that will be
generated by resizing along longest side.

### `ignore`

Array of file names to ignore.

### `remoteSync`

Boolean value indicating that a remote sync should occur (default: `false`)

### `s3Bucket`

The name of the S3 bucket to sync from/to.

## How to: run with Docker

I suggest you to use with Docker to avoid installing all dependencies in your host.

```sh
docker run \
-v "$(pwd)/volumes/src":/src \
-v "$(pwd)/volumes/dst":/dst \
-v "$(pwd)/config.json:/root/config.json" \
kopiro/tommy \
--src /src \
--dst /dst \
--config /root/config.json
```

Explanation of mounts:

- `-v "$(pwd)/volumes/src":/src` mount the source directory (where your assets are located) into container `/src`
- `-v "$(pwd)/volumes/dst":/dst` mount the destination directory (where your assets will be generated) into container `/dst`
- `-v "$(pwd)/config.json:/root/config.json"` mount your (optional) configuration JSON file into container `/root/config.json`

## How to: run in MacOS

Upfront, install dependencies by running `macos.sh`, then install with NPM:

```sh
npm -g i tommy
```

Then run as a binary:

```sh
tommy --src ./volumes/src --dst ./volumes/dst
```

## How: build locally Docker image

Download the repository, then run `./test-docker.sh`.

It will build the Docker image locally and test with volumes present in current repository.

## Configure AWS credentials

To use the _remote sync_ feature, you need to configure the binary `aws` to locale credentials.

When using with docker, you can just share your `.awscredentials` file through a volume in the path `/root/.aws/credentials`.

Otherwise, you can configure your `aws` via `aws configure`.

Example file:

```txt
[default]
aws_access_key_id=...
aws_secret_access_key=...
```

To mount:

```sh
docker run
...
-v "$(pwd)/.awscredentials":"/root/.aws/credentials"
...
```

## License

MIT
